var n=(u,r,s)=>new Promise((a,i)=>{var x=h=>{try{m(s.next(h))}catch(y){i(y)}},c=h=>{try{m(s.throw(h))}catch(y){i(y)}},m=h=>h.done?a(h.value):Promise.resolve(h.value).then(x,c);m((s=s.apply(u,r)).next())});import{r as f,j as e}from"./ui-vendor-nuurtrVt.js";import{s as o,e as O,m as N,g as V,U as A,B as w,j as G,H as J,h as v}from"./index-DvbzyI8D.js";import{B as _}from"./badge-CSla_laA.js";import{p as Q}from"./photosService-GinFDzdw.js";import{A as X}from"./arrow-left-BvVPu0ip.js";import{M as R}from"./map-pin-CW14yjCe.js";import{I as Y}from"./image-DX3VTrFv.js";import{C as Z}from"./chevron-right-DPiNpNpC.js";import{S as I}from"./send-Q2AREpcX.js";import{S as ee}from"./share-2-De9cE97H.js";import{A as se}from"./index-B8gLKG9C.js";import"./react-vendor-DwRCIQB9.js";import"./animation-vendor-BS_UIQcx.js";import"./supabase-vendor-FQ_Qbeq7.js";class te{likeMemory(r){return n(this,null,function*(){try{const{data:{user:s}}=yield o.auth.getUser();if(!s)return!1;const{error:a}=yield o.from("memory_likes").insert({memory_id:r,user_id:s.id});if(a)throw a;return!0}catch(s){return console.error("Error liking memory:",s),!1}})}unlikeMemory(r){return n(this,null,function*(){try{const{data:{user:s}}=yield o.auth.getUser();if(!s)return!1;const{error:a}=yield o.from("memory_likes").delete().eq("memory_id",r).eq("user_id",s.id);if(a)throw a;return!0}catch(s){return console.error("Error unliking memory:",s),!1}})}getMemoryLikes(r){return n(this,null,function*(){try{const{data:s,error:a}=yield o.from("memory_likes").select("*").eq("memory_id",r).order("created_at",{ascending:!1});if(a)throw a;return s||[]}catch(s){return console.error("Error getting memory likes:",s),[]}})}checkIfLiked(r){return n(this,null,function*(){try{const{data:{user:s}}=yield o.auth.getUser();if(!s)return!1;const{data:a,error:i}=yield o.from("memory_likes").select("id").eq("memory_id",r).eq("user_id",s.id).single();return!!a&&!i}catch(s){return!1}})}addComment(r,s){return n(this,null,function*(){try{const{data:{user:a}}=yield o.auth.getUser();if(!a)return null;const{data:i,error:x}=yield o.from("memory_comments").insert({memory_id:r,user_id:a.id,content:s}).select(`
          *,
          author:profiles!memory_comments_user_id_fkey (
            user_id,
            display_name,
            avatar_url
          )
        `).single();if(x)throw x;return i}catch(a){return console.error("Error adding comment:",a),null}})}getComments(r){return n(this,null,function*(){try{const{data:s,error:a}=yield o.from("memory_comments").select(`
          *,
          author:profiles!memory_comments_user_id_fkey (
            user_id,
            display_name,
            avatar_url
          )
        `).eq("memory_id",r).order("created_at",{ascending:!1});if(a)throw a;return s||[]}catch(s){return console.error("Error getting comments:",s),[]}})}deleteComment(r){return n(this,null,function*(){try{const{data:{user:s}}=yield o.auth.getUser();if(!s)return!1;const{error:a}=yield o.from("memory_comments").delete().eq("id",r).eq("user_id",s.id);if(a)throw a;return!0}catch(s){return console.error("Error deleting comment:",s),!1}})}shareMemory(r,s){return n(this,null,function*(){try{const{data:{user:a}}=yield o.auth.getUser();if(!a)return!1;const{error:i}=yield o.from("memory_shares").insert({memory_id:r,user_id:a.id,shared_to:s});if(i)throw i;return!0}catch(a){return console.error("Error sharing memory:",a),!1}})}getMemoryShares(r){return n(this,null,function*(){try{const{data:s,error:a}=yield o.from("memory_shares").select("*").eq("memory_id",r).order("created_at",{ascending:!1});if(a)throw a;return s||[]}catch(s){return console.error("Error getting memory shares:",s),[]}})}getMemoryStats(r){return n(this,null,function*(){try{const{data:{user:s}}=yield o.auth.getUser(),[a,i,x]=yield Promise.all([this.getMemoryLikes(r),this.getComments(r),this.getMemoryShares(r)]),c=s?yield this.checkIfLiked(r):!1;return{memory_id:r,like_count:a.length,comment_count:i.length,share_count:x.length,is_liked:c}}catch(s){return console.error("Error getting memory stats:",s),{memory_id:r,like_count:0,comment_count:0,share_count:0,is_liked:!1}}})}getMultipleMemoryStats(r){return n(this,null,function*(){const s=new Map;try{(yield Promise.all(r.map(i=>this.getMemoryStats(i)))).forEach(i=>{s.set(i.memory_id,i)})}catch(a){console.error("Error getting multiple memory stats:",a)}return s})}subscribeToMemoryUpdates(r,s,a){const i=o.channel(`memory_likes_${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"memory_likes",filter:`memory_id=eq.${r}`},c=>{s(c.new)}).subscribe(),x=o.channel(`memory_comments_${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"memory_comments",filter:`memory_id=eq.${r}`},c=>n(null,null,function*(){const{data:m}=yield o.from("memory_comments").select(`
              *,
              author:profiles!memory_comments_user_id_fkey (
                user_id,
                display_name,
                avatar_url
              )
            `).eq("id",c.new.id).single();m&&a(m)})).subscribe();return()=>{o.removeChannel(i),o.removeChannel(x)}}}const p=new te;function ye({category:u,onNavigate:r}){var U,q,P,D,B;const[s,a]=f.useState(null),[i,x]=f.useState("recent"),[c,m]=f.useState(new Map),[h,y]=f.useState([]),[b,k]=f.useState(""),[T,M]=f.useState(!1),j=Q.getMemoriesByCategory(u),$=i==="recent"?j:[...j].reverse();f.useEffect(()=>{const t=()=>n(null,null,function*(){const l=j.map(g=>g.id),d=yield p.getMultipleMemoryStats(l);m(d)});j.length>0&&t()},[j]),f.useEffect(()=>{if(s){z();const t=p.subscribeToMemoryUpdates(s.id,()=>S(),l=>y(d=>[l,...d]));return()=>t()}},[s]);const S=()=>n(null,null,function*(){if(!s)return;const t=yield p.getMemoryStats(s.id);m(l=>new Map(l).set(s.id,t))}),z=()=>n(null,null,function*(){if(!s)return;M(!0);const t=yield p.getComments(s.id);y(t),M(!1)}),H=t=>n(null,null,function*(){const l=c.get(t);(l==null?void 0:l.is_liked)?(yield p.unlikeMemory(t),v.success("Removed like")):(yield p.likeMemory(t),v.success("Liked! â¤ï¸"));const g=yield p.getMemoryStats(t);m(K=>new Map(K).set(t,g))}),C=()=>n(null,null,function*(){if(!s||!b.trim())return;const t=yield p.addComment(s.id,b);t&&(y(l=>[t,...l]),k(""),v.success("Comment added! ðŸ’¬"),yield S())}),F=t=>n(null,null,function*(){yield p.shareMemory(t,"community"),v.success("Memory shared! ðŸŽ‰");const l=yield p.getMemoryStats(t);m(d=>new Map(d).set(t,l))}),E={"ðŸ¥³ Excited":"ðŸ¥³","ðŸ˜­ Emotional":"ðŸ˜­","ðŸ˜Š Happy":"ðŸ˜Š","ðŸ¤© Amazed":"ðŸ¤©","ðŸ’ª Proud":"ðŸ’ª","ðŸ”¥ Energized":"ðŸ”¥"},W=()=>{switch(u){case"sports":return"âš½";case"events":return"ðŸŽµ";case"parties":return"ðŸŽ‰";case"gaming":return"ðŸŽ®"}},L=()=>u.charAt(0).toUpperCase()+u.slice(1);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[e.jsx("div",{className:"sticky top-0 z-20 bg-white/95 backdrop-blur-sm border-b border-slate-200",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>{r({sports:"dashboard",events:"events-dashboard",parties:"party-dashboard",gaming:"gaming-hub"}[u])},className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(X,{className:"w-6 h-6 text-slate-700"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-3xl",children:W()}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Memory Timeline"})]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Relive your best ",L()," moments"]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:i,onChange:t=>x(t.target.value),className:"px-4 py-2 border border-slate-200 rounded-lg bg-white text-slate-900 hover:border-slate-400 transition-colors",children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"oldest",children:"Oldest First"})]})})]})}),e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 text-lg",children:"No memories yet"}),e.jsxs("p",{className:"text-slate-500 text-sm mt-2",children:["Upload photos and create memories from your ",L()," moments!"]})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-1 bg-gradient-to-b from-slate-200 via-slate-300 to-slate-200"}),e.jsx("div",{className:"space-y-8",children:$.map((t,l)=>e.jsxs(N.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:l*.1},className:"ml-24 relative",children:[e.jsx("div",{className:"absolute -left-20 top-6 w-8 h-8 bg-white border-4 border-slate-300 rounded-full flex items-center justify-center shadow-lg",children:e.jsx("div",{className:"w-3 h-3 bg-gradient-to-r from-slate-400 to-slate-500 rounded-full"})}),e.jsxs(N.div,{whileHover:{scale:1.02,y:-5},onClick:()=>a(t),className:"bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all border border-slate-200 cursor-pointer group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:t.title}),e.jsx("span",{className:"text-2xl",children:E[t.mood]||t.mood.split(" ")[0]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(t.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:t.location})]})]})]}),e.jsx(_,{className:"bg-gradient-to-r from-slate-600 to-slate-700 text-white",children:t.category})]}),e.jsx("p",{className:"text-slate-700 mb-4 line-clamp-3",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Y,{className:"w-4 h-4 text-slate-600"}),e.jsx("span",{className:"text-xs text-slate-600",children:"Photos"})]}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.photos.length})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(A,{className:"w-4 h-4 text-slate-600"}),e.jsx("span",{className:"text-xs text-slate-600",children:"People"})]}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.participants.length})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-slate-600 mb-2",children:"People in this memory"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.participants.map((d,g)=>e.jsx(_,{className:"bg-slate-100 text-slate-700 border-slate-300",children:d},g))})]}),e.jsxs(w,{className:"w-full bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white group-hover:shadow-lg transition-all",children:["View Full Memory",e.jsx(Z,{className:"w-4 h-4 ml-2"})]})]})]},t.id))})]})}),e.jsx(se,{children:s&&e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>a(null),className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},onClick:t=>t.stopPropagation(),className:"bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-slate-600 to-slate-700 text-white p-6 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:E[s.mood]||s.mood.split(" ")[0]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.title}),e.jsx("p",{className:"text-sm text-white/80",children:new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsx("button",{onClick:()=>a(null),className:"text-white/80 hover:text-white transition-colors",children:"âœ•"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-3",children:"Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-slate-700",children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-slate-700",children:new Date(s.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-green-500"}),e.jsxs("span",{className:"text-slate-700",children:[s.participants.length," people attended"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-3",children:"What Happened"}),e.jsx("p",{className:"text-slate-700 leading-relaxed",children:s.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-3",children:"Memorable People"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.participants.map((t,l)=>e.jsx(_,{className:"bg-slate-100 text-slate-700 border-slate-300 text-base py-2 px-3",children:t},l))})]}),s.photos.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900 mb-3",children:["Photos (",s.photos.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:s.photos.map((t,l)=>e.jsx("div",{className:"aspect-square bg-gradient-to-br from-slate-200 to-slate-300 rounded-lg flex items-center justify-center text-5xl hover:scale-105 transition-transform cursor-pointer",children:t.url},l))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-slate-900 mb-3",children:["Comments (",((U=c.get(s.id))==null?void 0:U.comment_count)||0,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto mb-4",children:T?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Loading comments..."}):h.length===0?e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"No comments yet. Be the first!"}):h.map(t=>{var l,d,g;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center text-white text-sm font-semibold flex-shrink-0",children:((d=(l=t.author)==null?void 0:l.display_name)==null?void 0:d.charAt(0))||"U"}),e.jsxs("div",{className:"flex-1 bg-slate-50 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-sm text-slate-900 mb-1",children:((g=t.author)==null?void 0:g.display_name)||"User"}),e.jsx("p",{className:"text-sm text-slate-700",children:t.content}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:new Date(t.created_at).toLocaleTimeString()})]})]},t.id)})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:b,onChange:t=>k(t.target.value),onKeyDown:t=>t.key==="Enter"&&C(),placeholder:"Write a comment...",className:"flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500"}),e.jsx(w,{onClick:C,disabled:!b.trim(),className:"bg-slate-600 hover:bg-slate-700 text-white",children:e.jsx(I,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200",children:[e.jsxs(w,{onClick:()=>H(s.id),className:`flex-1 flex items-center justify-center gap-2 transition-all ${(q=c.get(s.id))!=null&&q.is_liked?"bg-rose-100 hover:bg-rose-200 text-rose-700":"bg-slate-100 hover:bg-slate-200 text-slate-900"}`,children:[e.jsx(J,{className:`w-4 h-4 ${(P=c.get(s.id))!=null&&P.is_liked?"fill-rose-500":""}`}),e.jsxs("span",{children:["Like (",((D=c.get(s.id))==null?void 0:D.like_count)||0,")"]})]}),e.jsxs(w,{onClick:()=>F(s.id),className:"flex-1 bg-slate-100 hover:bg-slate-200 text-slate-900 flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsxs("span",{children:["Share (",((B=c.get(s.id))==null?void 0:B.share_count)||0,")"]})]})]})]})]})})})]})}export{ye as MemoryTimeline};

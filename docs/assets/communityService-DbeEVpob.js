var _=Object.defineProperty,g=Object.defineProperties;var y=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var p=(m,e,t)=>e in m?_(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t,h=(m,e)=>{for(var t in e||(e={}))b.call(e,t)&&p(m,t,e[t]);if(f)for(var t of f(e))v.call(e,t)&&p(m,t,e[t]);return m},l=(m,e)=>g(m,y(e));var u=(m,e,t)=>p(m,typeof e!="symbol"?e+"":e,t);var o=(m,e,t)=>new Promise((a,r)=>{var i=c=>{try{d(t.next(c))}catch(w){r(w)}},n=c=>{try{d(t.throw(c))}catch(w){r(w)}},d=c=>c.done?a(c.value):Promise.resolve(c.value).then(i,n);d((t=t.apply(m,e)).next())});import{s}from"./index-Dp-8Rdet.js";class M{constructor(){u(this,"subscriptions",new Map)}getRooms(e){return o(this,null,function*(){const{data:t,error:a}=yield s.rpc("get_user_chat_rooms",{p_user_id:e});if(a)throw a;return t||[]})}getRoom(e){return o(this,null,function*(){const{data:t,error:a}=yield s.from("chat_rooms").select("*").eq("id",e).single();if(a)throw a;return t})}createRoom(e){return o(this,null,function*(){const{data:{user:t}}=yield s.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:a,error:r}=yield s.from("chat_rooms").insert(l(h({},e),{created_by:t.id})).select().single();if(r)throw r;return yield this.addMember(a.id,t.id,"admin"),a})}updateRoom(e,t){return o(this,null,function*(){const{error:a}=yield s.from("chat_rooms").update(t).eq("id",e);if(a)throw a})}deleteRoom(e){return o(this,null,function*(){const{error:t}=yield s.from("chat_rooms").delete().eq("id",e);if(t)throw t})}getMembers(e){return o(this,null,function*(){const{data:t,error:a}=yield s.from("chat_room_members").select(`
        *,
        user:profiles(id, full_name, avatar_url)
      `).eq("room_id",e);if(a)throw a;return t||[]})}addMember(e,t,a="member"){return o(this,null,function*(){const{error:r}=yield s.from("chat_room_members").insert({room_id:e,user_id:t,role:a});if(r)throw r})}getMemberRole(e){return o(this,null,function*(){var i;const{data:{user:t}}=yield s.auth.getUser();if(!t)return null;const{data:a,error:r}=yield s.from("chat_room_members").select("role").eq("room_id",e).eq("user_id",t.id).single();if(r&&r.code!=="PGRST116")throw r;return(i=a==null?void 0:a.role)!=null?i:null})}removeMember(e,t){return o(this,null,function*(){const{error:a}=yield s.from("chat_room_members").delete().eq("room_id",e).eq("user_id",t);if(a)throw a})}updateMemberRole(e,t,a){return o(this,null,function*(){const{error:r}=yield s.from("chat_room_members").update({role:a}).eq("room_id",e).eq("user_id",t);if(r)throw r})}promoteToModerator(e,t){return o(this,null,function*(){yield this.updateMemberRole(e,t,"moderator")})}promoteToAdmin(e,t){return o(this,null,function*(){yield this.updateMemberRole(e,t,"admin")})}markAsRead(e){return o(this,null,function*(){const{data:{user:t}}=yield s.auth.getUser();if(!t)return;const{error:a}=yield s.from("chat_room_members").update({last_read_at:new Date().toISOString()}).eq("room_id",e).eq("user_id",t.id);if(a)throw a})}getMessages(e,t=50,a){return o(this,null,function*(){let r=s.from("chat_messages").select(`
        *,
        sender:profiles(id, full_name, avatar_url)
      `).eq("room_id",e).eq("is_deleted",!1).order("created_at",{ascending:!1}).limit(t);a&&(r=r.lt("created_at",a));const{data:i,error:n}=yield r;if(n)throw n;return(i||[]).reverse()})}deleteMessage(e,t,a){return o(this,null,function*(){const{data:{user:r}}=yield s.auth.getUser();if(!r)throw new Error("Not authenticated");const{error:i}=yield s.from("chat_messages").update({is_deleted:!0,content:"[deleted by moderator]",media_url:null,media_thumbnail:null,updated_at:new Date().toISOString()}).eq("id",t).eq("room_id",e);if(i)throw i;yield s.from("chat_moderation_actions").insert({room_id:e,actor_id:r.id,action_type:"delete_message",target_message_id:t,reason:a})})}reportMessage(e,t,a,r){return o(this,null,function*(){const{data:{user:i}}=yield s.auth.getUser();if(!i)throw new Error("Not authenticated");const{data:n,error:d}=yield s.from("chat_message_reports").insert({room_id:e,message_id:t,reporter_id:i.id,reason:a,details:r,status:"pending"}).select().single();if(d)throw d;return n})}getModerationActions(e,t=20){return o(this,null,function*(){const{data:a,error:r}=yield s.from("chat_moderation_actions").select("*").eq("room_id",e).order("created_at",{ascending:!1}).limit(t);if(r)throw r;return a||[]})}pinMessage(e,t){return o(this,null,function*(){const{data:{user:a}}=yield s.auth.getUser();if(!a)throw new Error("Not authenticated");const{error:r}=yield s.from("chat_pinned_messages").insert({room_id:e,message_id:t,pinned_by:a.id});if(r)throw r;yield s.from("chat_moderation_actions").insert({room_id:e,actor_id:a.id,action_type:"pin_message",target_message_id:t})})}unpinMessage(e,t){return o(this,null,function*(){const{error:a}=yield s.from("chat_pinned_messages").delete().eq("room_id",e).eq("message_id",t);if(a)throw a})}getPinnedMessages(e){return o(this,null,function*(){const{data:t,error:a}=yield s.from("chat_pinned_messages").select(`
        *,
        message:chat_messages(
          *,
          sender:profiles(id, full_name, avatar_url)
        )
      `).eq("room_id",e).order("pinned_at",{ascending:!1});if(a)throw a;return t||[]})}kickUser(e,t,a){return o(this,null,function*(){const{data:{user:r}}=yield s.auth.getUser();if(!r)throw new Error("Not authenticated");yield this.removeMember(e,t),yield s.from("chat_moderation_actions").insert({room_id:e,actor_id:r.id,action_type:"kick_user",target_user_id:t,reason:a})})}banUser(e,t,a){return o(this,null,function*(){const{data:{user:r}}=yield s.auth.getUser();if(!r)throw new Error("Not authenticated");yield this.removeMember(e,t),yield s.from("chat_moderation_actions").insert({room_id:e,actor_id:r.id,action_type:"ban_user",target_user_id:t,reason:a})})}muteUser(e,t,a){return o(this,null,function*(){const{data:{user:r}}=yield s.auth.getUser();if(!r)throw new Error("Not authenticated");const{error:i}=yield s.from("chat_room_members").update({is_muted:!0}).eq("room_id",e).eq("user_id",t);if(i)throw i;yield s.from("chat_moderation_actions").insert({room_id:e,actor_id:r.id,action_type:"mute_user",target_user_id:t,reason:a})})}unmuteUser(e,t){return o(this,null,function*(){const{error:a}=yield s.from("chat_room_members").update({is_muted:!1}).eq("room_id",e).eq("user_id",t);if(a)throw a})}searchMessages(e,t,a=20){return o(this,null,function*(){const{data:r,error:i}=yield s.from("chat_messages").select(`
        *,
        sender:profiles(id, full_name, avatar_url)
      `).eq("room_id",e).eq("is_deleted",!1).ilike("content",`%${t}%`).order("created_at",{ascending:!1}).limit(a);if(i)throw i;return r||[]})}sendMessage(e,t,a="text",r){return o(this,null,function*(){const{data:{user:i}}=yield s.auth.getUser();if(!i)throw new Error("Not authenticated");const{data:n,error:d}=yield s.from("chat_messages").insert({room_id:e,sender_id:i.id,content:t,message_type:a,media_url:r}).select(`
        *,
        sender:profiles(id, full_name, avatar_url)
      `).single();if(d)throw d;return yield this.markAsRead(e),n})}updateMessage(e,t){return o(this,null,function*(){const{error:a}=yield s.from("chat_messages").update({content:t,is_edited:!0,updated_at:new Date().toISOString()}).eq("id",e);if(a)throw a})}addReaction(e,t){return o(this,null,function*(){const{data:{user:a}}=yield s.auth.getUser();if(!a)throw new Error("Not authenticated");const{error:r}=yield s.from("message_reactions").insert({message_id:e,user_id:a.id,emoji:t});if(r)throw r})}removeReaction(e,t){return o(this,null,function*(){const{data:{user:a}}=yield s.auth.getUser();if(!a)throw new Error("Not authenticated");const{error:r}=yield s.from("message_reactions").delete().eq("message_id",e).eq("user_id",a.id).eq("emoji",t);if(r)throw r})}getReactions(e){return o(this,null,function*(){const{data:t,error:a}=yield s.from("message_reactions").select("*").eq("message_id",e);if(a)throw a;return t||[]})}subscribeToRoom(e,t){const a=`room:${e}`;this.subscriptions.has(a)&&this.unsubscribeFromRoom(e);const r=s.channel(a).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`room_id=eq.${e}`},i=>o(this,null,function*(){const{data:n}=yield s.from("chat_messages").select(`
              *,
              sender:profiles(id, full_name, avatar_url)
            `).eq("id",i.new.id).single();n&&t(n)})).subscribe();return this.subscriptions.set(a,r),()=>this.unsubscribeFromRoom(e)}unsubscribeFromRoom(e){const t=`room:${e}`,a=this.subscriptions.get(t);a&&(s.removeChannel(a),this.subscriptions.delete(t))}unsubscribeAll(){this.subscriptions.forEach(e=>{s.removeChannel(e)}),this.subscriptions.clear()}getUnreadCount(e){return o(this,null,function*(){const{data:{user:t}}=yield s.auth.getUser();if(!t)return 0;const{data:a,error:r}=yield s.rpc("get_unread_message_count",{p_user_id:t.id,p_room_id:e});if(r)throw r;return a||0})}softExitGroup(e){return o(this,null,function*(){const{data:{user:t}}=yield s.auth.getUser();if(!t)throw new Error("Not authenticated");if(!(yield this.getRoom(e)))throw new Error("Room not found");const i=(yield this.getMembers(e)).filter(n=>n.role==="admin");if(yield this.removeMember(e,t.id),i.length>0){const{data:n}=yield s.from("profiles").select("full_name").eq("user_id",t.id).single(),d=(n==null?void 0:n.full_name)||"A member";yield s.from("chat_messages").insert({room_id:e,sender_id:t.id,content:`ðŸšª ${d} left the group quietly`,message_type:"system"})}})}}const P=new M,k=[{id:"bandra",name:"Bandra",city:"Mumbai",memberCount:342,activeMatches:12,description:"West Mumbai's sports hub with vibrant community"},{id:"andheri",name:"Andheri",city:"Mumbai",memberCount:428,activeMatches:18,description:"Active sports community in the heart of suburbs"},{id:"powai",name:"Powai",city:"Mumbai",memberCount:267,activeMatches:9,description:"Lake-side community with weekend warriors"},{id:"juhu",name:"Juhu",city:"Mumbai",memberCount:189,activeMatches:7,description:"Beach-side sports and cultural events"},{id:"malad",name:"Malad",city:"Mumbai",memberCount:312,activeMatches:14,description:"Growing community with diverse sports"}];class A{constructor(){u(this,"areas",k);u(this,"posts",[]);u(this,"events",[]);this.generateMockData()}generateMockData(){const e=Date.now();this.posts=[{id:"post-1",area:"bandra",authorId:"user1",authorName:"Rahul Sharma",authorAvatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100",title:"Weekly Football Tournament Starting Next Month! ðŸ†",content:"Hey Bandra community! We're organizing a 5-a-side tournament every Saturday. All skill levels welcome. Trust score 80+ preferred. Let's make this epic!",category:"announcement",timestamp:new Date(e-7200*1e3),likes:24,comments:[{id:"comment-1",postId:"post-1",authorId:"user2",authorName:"Priya Singh",authorAvatar:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100",content:"Count me in! This sounds amazing ðŸŽ‰",timestamp:new Date(e-3600*1e3),likes:5},{id:"comment-2",postId:"post-1",authorId:"user3",authorName:"Amit Patel",authorAvatar:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100",content:"Finally! Been waiting for something like this. When's registration?",timestamp:new Date(e-2700*1e3),likes:3}],isPinned:!0},{id:"post-2",area:"andheri",authorId:"user4",authorName:"Sneha Desai",authorAvatar:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100",title:"Best turfs in Andheri for evening matches?",content:"Looking for recommendations for good turfs with decent facilities. Preferably with changing rooms and parking. Where do you all usually play?",category:"question",timestamp:new Date(e-300*60*1e3),likes:12,comments:[{id:"comment-3",postId:"post-2",authorId:"user5",authorName:"Karan Mehta",authorAvatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100",content:"Andheri Sports Complex is great! Good facilities and well maintained.",timestamp:new Date(e-14400*1e3),likes:7}],isPinned:!1},{id:"post-3",area:"powai",authorId:"user6",authorName:"Vikram Reddy",authorAvatar:"https://images.unsplash.com/photo-1463453091185-61582044d556?w=100",title:"Hit my 50-game milestone! ðŸŽ‰",content:"Just completed my 50th match on Avento! Thank you to this amazing community for all the memories. From a nervous newbie to a confident player - what a journey!",category:"achievement",timestamp:new Date(e-1440*60*1e3),likes:48,comments:[{id:"comment-4",postId:"post-3",authorId:"user1",authorName:"Rahul Sharma",authorAvatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100",content:"Congratulations! Here's to the next 50! ðŸš€",timestamp:new Date(e-1380*60*1e3),likes:4}],isPinned:!1},{id:"post-4",area:"juhu",authorId:"user7",authorName:"Neha Gupta",authorAvatar:"https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100",title:"Beach Volleyball this Sunday?",content:"Weather is looking perfect for beach volleyball this Sunday morning at Juhu Beach. Looking for 8-10 people. Newbie-friendly! Who's in? ðŸ",category:"event",timestamp:new Date(e-480*60*1e3),likes:18,comments:[],isPinned:!1},{id:"post-5",area:"malad",authorId:"user8",authorName:"Arjun Kumar",authorAvatar:"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100",title:"Tips for building trust score?",content:"I've been playing for 2 months now and my trust score is stuck at 78. Any tips from veteran players on how to improve it faster?",category:"discussion",timestamp:new Date(e-720*60*1e3),likes:9,comments:[{id:"comment-5",postId:"post-5",authorId:"user2",authorName:"Priya Singh",authorAvatar:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100",content:"Be consistently on time, communicate well with your team, and always show up. That's the secret!",timestamp:new Date(e-660*60*1e3),likes:12}],isPinned:!1}],this.events=[{id:"event-1",area:"bandra",title:"Weekend Football League",description:"5-a-side tournament every Saturday. Registration open!",date:new Date(e+10080*60*1e3),location:"Bandra Sports Complex",organizerId:"user1",organizerName:"Rahul Sharma",attendees:["user1","user2","user3","user4","user5"],maxAttendees:40,category:"tournament"},{id:"event-2",area:"andheri",title:"Community Meetup & Cricket",description:"Let's meet, play, and strengthen our community bonds!",date:new Date(e+4320*60*1e3),location:"Andheri Sports Arena",organizerId:"user4",organizerName:"Sneha Desai",attendees:["user4","user5","user6"],maxAttendees:20,category:"meetup"},{id:"event-3",area:"powai",title:"Fitness Workshop: Injury Prevention",description:"Learn from certified trainers about staying fit and avoiding injuries.",date:new Date(e+14400*60*1e3),location:"Powai Lake Garden",organizerId:"user6",organizerName:"Vikram Reddy",attendees:["user6","user7"],maxAttendees:15,category:"workshop"}]}getAllAreas(){return this.areas}getAreaById(e){return this.areas.find(t=>t.id===e)||null}getPostsByArea(e){return this.posts.filter(t=>t.area===e).sort((t,a)=>t.isPinned&&!a.isPinned?-1:!t.isPinned&&a.isPinned?1:a.timestamp.getTime()-t.timestamp.getTime())}getAllPosts(){return this.posts.sort((e,t)=>e.isPinned&&!t.isPinned?-1:!e.isPinned&&t.isPinned?1:t.timestamp.getTime()-e.timestamp.getTime())}getPostById(e){return this.posts.find(t=>t.id===e)||null}createPost(e){const t=l(h({},e),{id:`post-${Date.now()}-${Math.random()}`,timestamp:new Date,likes:0,comments:[],isPinned:!1});return this.posts.unshift(t),t}likePost(e){const t=this.posts.find(a=>a.id===e);t&&t.likes++}addComment(e,t){const a=this.posts.find(i=>i.id===e);if(!a)throw new Error("Post not found");const r=l(h({},t),{id:`comment-${Date.now()}-${Math.random()}`,postId:e,timestamp:new Date,likes:0});return a.comments.push(r),r}getEventsByArea(e){return this.events.filter(t=>t.area===e).sort((t,a)=>t.date.getTime()-a.date.getTime())}getAllEvents(){return this.events.sort((e,t)=>e.date.getTime()-t.date.getTime())}getUpcomingEvents(e){const t=this.events.filter(a=>a.date.getTime()>Date.now()).sort((a,r)=>a.date.getTime()-r.date.getTime());return e?t.slice(0,e):t}joinEvent(e,t){const a=this.events.find(r=>r.id===e);if(!a)throw new Error("Event not found");if(a.maxAttendees&&a.attendees.length>=a.maxAttendees)throw new Error("Event is full");a.attendees.includes(t)||a.attendees.push(t)}leaveEvent(e,t){const a=this.events.find(r=>r.id===e);if(!a)throw new Error("Event not found");a.attendees=a.attendees.filter(r=>r!==t)}}const R=new A;export{R as a,P as c};

var g=Object.defineProperty,N=Object.defineProperties;var y=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var c=(r,t,e)=>t in r?g(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,n=(r,t)=>{for(var e in t||(t={}))S.call(t,e)&&c(r,e,t[e]);if(h)for(var e of h(t))b.call(t,e)&&c(r,e,t[e]);return r},a=(r,t)=>N(r,y(t));var f=(r,t,e)=>c(r,typeof t!="symbol"?t+"":t,e);const u={userId:"",matchUpdates:{enabled:!0,push:!0,email:!0,inApp:!0},friendActivity:{enabled:!0,push:!0,email:!1,inApp:!0},achievements:{enabled:!0,push:!0,email:!1,inApp:!0},paymentReminders:{enabled:!0,push:!0,email:!0,inApp:!0},communityUpdates:{enabled:!0,push:!1,email:!1,inApp:!0},promotions:{enabled:!1,push:!1,email:!1,inApp:!0},quietHours:{enabled:!1,startTime:"22:00",endTime:"08:00"},matchDayOnly:!1};class P{constructor(){f(this,"preferences",new Map);f(this,"notifications",new Map);this.initializeDefaults()}initializeDefaults(){["user1","user2","user3","user4","user5"].forEach(t=>{this.preferences.set(t,a(n({},u),{userId:t}))})}getPreferences(t){return this.preferences.get(t)||a(n({},u),{userId:t})}updatePreferences(t,e){const i=this.getPreferences(t),s=n(n({},i),e);return this.preferences.set(t,s),s}updateCategoryPreferences(t,e,i){const s=this.getPreferences(t),o=a(n({},s),{[e]:n(n({},s[e]),i)});return this.preferences.set(t,o),o}enableQuietHours(t,e,i){const s=this.getPreferences(t),o=a(n({},s),{quietHours:{enabled:!0,startTime:e,endTime:i}});return this.preferences.set(t,o),o}disableQuietHours(t){const e=this.getPreferences(t),i=a(n({},e),{quietHours:a(n({},e.quietHours),{enabled:!1})});return this.preferences.set(t,i),i}toggleMatchDayOnly(t){const e=this.getPreferences(t),i=a(n({},e),{matchDayOnly:!e.matchDayOnly});return this.preferences.set(t,i),i}shouldSendNotification(t,e,i){const s=this.getPreferences(t),o=s[e];if(!o.enabled||!o[i])return!1;if(s.quietHours.enabled&&i==="push"){const l=new Date,p=`${l.getHours().toString().padStart(2,"0")}:${l.getMinutes().toString().padStart(2,"0")}`,{startTime:d,endTime:m}=s.quietHours;if(p>=d||p<=m)return!1}return!0}resetToDefaults(t){const e=a(n({},u),{userId:t});return this.preferences.set(t,e),e}addNotification(t){const e=`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i=a(n({},t),{id:e});return this.notifications.has(t.userId)||this.notifications.set(t.userId,[]),this.notifications.get(t.userId).push(i),this.persistNotifications(t.userId),i}getNotifications(t,e=50){return(this.notifications.get(t)||[]).slice(-e).reverse()}getUnreadCount(t){return(this.notifications.get(t)||[]).filter(i=>!i.read).length}markAsRead(t,e){const s=(this.notifications.get(t)||[]).find(o=>o.id===e);s&&(s.read=!0,this.persistNotifications(t))}markAllAsRead(t){(this.notifications.get(t)||[]).forEach(i=>{i.read=!0}),this.persistNotifications(t)}deleteNotification(t,e){const i=this.notifications.get(t)||[],s=i.findIndex(o=>o.id===e);s!==-1&&(i.splice(s,1),this.persistNotifications(t))}clearNotifications(t){this.notifications.set(t,[]),this.persistNotifications(t)}persistNotifications(t){const e=this.notifications.get(t)||[];try{localStorage.setItem(`notifications_${t}`,JSON.stringify(e.map(i=>a(n({},i),{timestamp:i.timestamp.toISOString()}))))}catch(i){console.error("Failed to persist notifications:",i)}}loadNotifications(t){try{const e=localStorage.getItem(`notifications_${t}`);if(e){const i=JSON.parse(e).map(s=>a(n({},s),{timestamp:new Date(s.timestamp)}));this.notifications.set(t,i)}}catch(e){console.error("Failed to load notifications:",e)}}getPaymentReminders(t,e){return(this.notifications.get(t)||[]).filter(s=>s.type==="payment_reminder"&&s.matchId===e)}}const D=new P;export{D as n};

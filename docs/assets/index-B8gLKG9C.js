var D=Object.defineProperty;var z=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var I=(e,n,t)=>n in e?D(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,L=(e,n)=>{for(var t in n||(n={}))H.call(n,t)&&I(e,t,n[t]);if(z)for(var t of z(n))U.call(n,t)&&I(e,t,n[t]);return e};import{r,j as R}from"./ui-vendor-nuurtrVt.js";import{K as V,N as S,O as B,Q as F,V as G,W as N}from"./index-DvbzyI8D.js";import{aj as O}from"./animation-vendor-BS_UIQcx.js";function W(e,n){if(typeof e=="function")return e(n);e!=null&&(e.current=n)}function Q(...e){return n=>{let t=!1;const o=e.map(i=>{const s=W(i,n);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let i=0;i<o.length;i++){const s=o[i];typeof s=="function"?s():W(e[i],null)}}}}function T(...e){return r.useCallback(Q(...e),e)}class X extends r.Component{getSnapshotBeforeUpdate(n){const t=this.props.childRef.current;if(t&&n.isPresent&&!this.props.isPresent){const o=t.offsetParent,i=O(o)&&o.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=i-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function _({children:e,isPresent:n,anchorX:t,root:o}){const i=r.useId(),s=r.useRef(null),h=r.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:g}=r.useContext(V),E=T(s,e==null?void 0:e.ref);return r.useInsertionEffect(()=>{const{width:f,height:m,top:u,left:a,right:p}=h.current;if(n||!s.current||!f||!m)return;const C=t==="left"?`left: ${a}`:`right: ${p}`;s.current.dataset.motionPopId=i;const l=document.createElement("style");g&&(l.nonce=g);const P=o!=null?o:document.head;return P.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${m}px !important;
            ${C}px !important;
            top: ${u}px !important;
          }
        `),()=>{P.contains(l)&&P.removeChild(l)}},[n]),R.jsx(X,{isPresent:n,childRef:s,sizeRef:h,children:r.cloneElement(e,{ref:E})})}const q=({children:e,initial:n,isPresent:t,onExitComplete:o,custom:i,presenceAffectsLayout:s,mode:h,anchorX:g,root:E})=>{const f=S(J),m=r.useId();let u=!0,a=r.useMemo(()=>(u=!1,{id:m,initial:n,isPresent:t,custom:i,onExitComplete:p=>{f.set(p,!0);for(const C of f.values())if(!C)return;o&&o()},register:p=>(f.set(p,!1),()=>f.delete(p))}),[t,f,o]);return s&&u&&(a=L({},a)),r.useMemo(()=>{f.forEach((p,C)=>f.set(C,!1))},[t]),r.useEffect(()=>{!t&&!f.size&&o&&o()},[t]),h==="popLayout"&&(e=R.jsx(_,{isPresent:t,anchorX:g,root:E,children:e})),R.jsx(B.Provider,{value:a,children:e})};function J(){return new Map}const j=e=>e.key||"";function K(e){const n=[];return r.Children.forEach(e,t=>{r.isValidElement(t)&&n.push(t)}),n}const ne=({children:e,custom:n,initial:t=!0,onExitComplete:o,presenceAffectsLayout:i=!0,mode:s="sync",propagate:h=!1,anchorX:g="left",root:E})=>{const[f,m]=F(h),u=r.useMemo(()=>K(e),[e]),a=h&&!f?[]:u.map(j),p=r.useRef(!0),C=r.useRef(u),l=S(()=>new Map),[P,b]=r.useState(u),[x,k]=r.useState(u);G(()=>{p.current=!1,C.current=u;for(let d=0;d<x.length;d++){const c=j(x[d]);a.includes(c)?l.delete(c):l.get(c)!==!0&&l.set(c,!1)}},[x,a.length,a.join("-")]);const w=[];if(u!==P){let d=[...u];for(let c=0;c<x.length;c++){const y=x[c],$=j(y);a.includes($)||(d.splice(c,0,y),w.push(y))}return s==="wait"&&w.length&&(d=w),k(K(d)),b(u),null}const{forceRender:M}=r.useContext(N);return R.jsx(R.Fragment,{children:x.map(d=>{const c=j(d),y=h&&!f?!1:u===x||a.includes(c),$=()=>{if(l.has(c))l.set(c,!0);else return;let v=!0;l.forEach(A=>{A||(v=!1)}),v&&(M==null||M(),k(C.current),h&&(m==null||m()),o&&o())};return R.jsx(q,{isPresent:y,initial:!p.current||t?void 0:!1,custom:n,presenceAffectsLayout:i,mode:s,root:E,onExitComplete:y?void 0:$,anchorX:g,children:d},c)})})};export{ne as A};

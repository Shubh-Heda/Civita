var le=Object.defineProperty,oe=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var J=(c,l,o)=>l in c?le(c,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[l]=o,k=(c,l)=>{for(var o in l||(l={}))ne.call(l,o)&&J(c,o,l[o]);if(W)for(var o of W(l))ce.call(l,o)&&J(c,o,l[o]);return c},_=(c,l)=>oe(c,ie(l));var x=(c,l,o)=>new Promise((m,N)=>{var g=h=>{try{f(o.next(h))}catch(u){N(u)}},C=h=>{try{f(o.throw(h))}catch(u){N(u)}},f=h=>h.done?m(h.value):Promise.resolve(h.value).then(g,C);f((o=o.apply(c,l)).next())});import{r as i,j as e}from"./ui-vendor-nuurtrVt.js";import{B as j,D as de,X as me,H as he,E as xe}from"./index-Dp-8Rdet.js";import{c as d,m as V}from"./communityPostService-BhPOQZfx.js";import{A as ue}from"./arrow-left-3xricN8T.js";import{I as pe}from"./image-CzImxzPF.js";import{S as ge}from"./send-CrWsU_NL.js";import{M as fe}from"./map-pin-dgmPVUiH.js";import{M as be}from"./message-circle-B3iZHPQz.js";import{S as ve}from"./share-2-Cp-JSdVN.js";import{B as je}from"./bookmark-xc8mavle.js";import"./react-vendor-DwRCIQB9.js";import"./animation-vendor-BS_UIQcx.js";import"./supabase-vendor-FQ_Qbeq7.js";function ze({onNavigate:c,category:l}){const[o,m]=i.useState([]),[N,g]=i.useState(!0),[C,f]=i.useState(!1),[h,u]=i.useState(0),[F,L]=i.useState(null),[$,X]=i.useState({}),[Ne,q]=i.useState(!1),[b,P]=i.useState(""),[G,I]=i.useState(""),[v,S]=i.useState([]),[M,E]=i.useState([]),[R,U]=i.useState(!1),z=i.useRef(null),A=i.useCallback((s=!1)=>x(null,null,function*(){try{g(!0);const t=yield d.post.getFeed({category:l||void 0,limit:20,offset:s?h:0,sort_by:"latest"});s?(m(a=>[...a,...t.posts]),u(a=>a+t.posts.length)):(m(t.posts),u(t.posts.length)),f(t.has_more)}catch(t){console.error("Error loading feed:",t)}finally{g(!1)}}),[l,h]);i.useEffect(()=>{u(0),m([]),x(null,null,function*(){try{g(!0);const a=yield d.post.getFeed({category:l||void 0,limit:20,offset:0,sort_by:"latest"});m(a.posts),u(a.posts.length),f(a.has_more)}catch(a){console.error("Error loading feed:",a)}finally{g(!1)}});const t=d.realtime.subscribeToFeed(l||null,a=>{m(r=>[a,...r])});return()=>{t()}},[l]);const K=s=>x(null,null,function*(){try{const t=yield d.comment.getComments(s);X(a=>_(k({},a),{[s]:t}))}catch(t){console.error("Error loading comments:",t)}}),Q=(s,t)=>x(null,null,function*(){try{t?yield d.like.unlikePost(s):yield d.like.likePost(s),m(a=>a.map(r=>r.id===s?_(k({},r),{like_count:t?r.like_count-1:r.like_count+1,user_has_liked:!t}):r))}catch(a){console.error("Error liking post:",a)}}),Y=s=>x(null,null,function*(){F===s?L(null):(L(s),$[s]||(yield K(s)))}),Z=s=>x(null,null,function*(){try{yield d.share.sharePost(s),m(t=>t.map(a=>a.id===s?_(k({},a),{share_count:a.share_count+1}):a)),alert("Post shared successfully!")}catch(t){console.error("Error sharing post:",t)}}),ee=(s,t)=>x(null,null,function*(){try{t?yield d.bookmark.unbookmarkPost(s):yield d.bookmark.bookmarkPost(s),m(a=>a.map(r=>r.id===s?_(k({},r),{user_has_bookmarked:!t}):r))}catch(a){console.error("Error bookmarking post:",a)}}),se=s=>x(null,null,function*(){const t=prompt("Enter user IDs to invite (comma-separated):");if(t)try{const a=t.split(",").map(r=>r.trim());yield d.invite.inviteUsers(s,a),alert(`Invited ${a.length} users to this post!`)}catch(a){console.error("Error inviting users:",a),alert("Failed to invite users")}}),te=s=>{const t=Array.from(s.target.files||[]),a=V.validateFiles(t);if(!a.valid){alert(a.errors.join(`
`));return}S(t);const r=t.map(p=>URL.createObjectURL(p));E(r)},ae=s=>{S(t=>t.filter((a,r)=>r!==s)),URL.revokeObjectURL(M[s]),E(t=>t.filter((a,r)=>r!==s))},B=()=>x(null,null,function*(){if(b.trim())try{U(!0);const s=yield d.post.createPost({content:b,category:l||"general",location:G||void 0,is_public:!0,tags:re(b)});if(!s)throw new Error("Failed to create post");v.length>0&&(yield V.uploadMultipleMedia(v,s.id)),P(""),I(""),S([]),E([]),q(!1),yield A(!1)}catch(s){console.error("Error creating post:",s),alert("Failed to create post. Please try again.")}finally{U(!1)}}),re=s=>{const t=/#[\w]+/g,a=s.match(t);return a?a.map(r=>r.slice(1)):[]},D=s=>{const t=new Date(s),r=new Date().getTime()-t.getTime(),p=Math.floor(r/6e4),w=Math.floor(r/36e5),y=Math.floor(r/864e5);return p<1?"Just now":p<60?`${p}m ago`:w<24?`${w}h ago`:y<7?`${y}d ago`:t.toLocaleDateString()};return e.jsxs("div",{className:"relative min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 overflow-hidden",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/3 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 right-0 w-96 h-96 bg-pink-500/10 rounded-full blur-3xl"})]}),e.jsx("header",{className:"relative z-40 backdrop-blur-sm border-b border-slate-800/50 bg-slate-950/80",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>c("dashboard"),className:"gap-2 hover:bg-slate-800 text-slate-100",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"flex items-center gap-2 text-2xl font-bold",children:[e.jsx("span",{children:"ðŸŒ"}),e.jsx("span",{className:"bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent",children:l?`${l.charAt(0).toUpperCase()+l.slice(1)} Community`:"Community Feed"})]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Connect with your community"})]})]})})}),e.jsxs("div",{className:"relative z-20 max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/40 border border-slate-700/50 rounded-xl p-6 backdrop-blur-sm",children:[e.jsx("textarea",{value:b,onChange:s=>P(s.target.value),placeholder:"What's happening in your community?",className:"w-full min-h-[120px] p-4 bg-slate-900/50 border border-slate-700/50 rounded-lg text-slate-100 placeholder-slate-500 resize-none focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent"}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-slate-700/50",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:z,type:"file",accept:"image/*,video/*",multiple:!0,onChange:te,className:"hidden"}),e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>{var s;return(s=z.current)==null?void 0:s.click()},className:"gap-2 text-slate-400 hover:text-slate-300 hover:bg-slate-700/50",disabled:v.length>=4,children:[e.jsx(pe,{className:"w-4 h-4"}),v.length>0?`${v.length}/4`:"Add Photo/Video"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>P(""),className:"text-slate-400 hover:text-slate-300 hover:bg-slate-700/50",children:"Clear"}),e.jsx(j,{onClick:B,disabled:!b.trim()||R,className:"bg-gradient-to-r from-cyan-500 to-blue-600 text-white hover:from-cyan-600 hover:to-blue-700",children:R?e.jsxs(e.Fragment,{children:[e.jsx(Loader,{className:"w-4 h-4 animate-spin mr-2"}),"Posting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Post"]})})]})]}),M.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mt-4 pt-4 border-t border-slate-700/50",children:M.map((s,t)=>e.jsxs("div",{className:"relative group",children:[v[t].type.startsWith("video/")?e.jsxs("div",{className:"relative bg-slate-900 rounded-lg overflow-hidden",children:[e.jsx("video",{src:s,className:"w-full h-24 object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 group-hover:bg-black/60 transition-colors",children:e.jsx(de,{className:"w-6 h-6 text-white"})})]}):e.jsx("img",{src:s,alt:"",className:"w-full h-24 object-cover rounded-lg"}),e.jsx("button",{onClick:()=>ae(t),className:"absolute top-1 right-1 bg-rose-500/90 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(me,{className:"w-3 h-3"})})]},t))})]}),e.jsxs("div",{className:"space-y-4",children:[N&&o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"Loading posts..."})]}):o.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-800/20 border border-slate-700/50 rounded-xl",children:[e.jsx("p",{className:"text-slate-400 mb-4",children:"No posts yet. Be the first to share!"}),e.jsx(j,{onClick:()=>b?B():null,className:"bg-gradient-to-r from-cyan-500 to-blue-600 text-white hover:from-cyan-600 hover:to-blue-700",children:"Create First Post"})]}):o.map((s,t)=>{var a,r,p,w,y;return e.jsxs("div",{className:"bg-slate-800/40 border border-slate-700/50 rounded-xl overflow-hidden hover:border-slate-600/50 transition-colors",children:[e.jsx("div",{className:"p-4 flex items-start justify-between border-b border-slate-700/50",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("img",{src:((a=s.author)==null?void 0:a.avatar_url)||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.author_id}`,alt:(r=s.author)==null?void 0:r.display_name,className:"w-12 h-12 rounded-full border border-slate-600/50"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-bold text-slate-100",children:(p=s.author)==null?void 0:p.display_name}),e.jsxs("span",{className:"text-slate-500",children:["@",(w=s.author)==null?void 0:w.username]}),e.jsx("span",{className:"text-slate-600",children:"Â·"}),e.jsx("span",{className:"text-slate-500 text-sm",children:D(s.created_at)})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-500 mt-1",children:[e.jsx(fe,{className:"w-3 h-3"}),s.location]})]})]})}),e.jsx("div",{className:"px-4 py-3",children:e.jsx("p",{className:"text-slate-200 whitespace-pre-wrap",children:s.content})}),s.media&&s.media.length>0&&e.jsx("div",{className:`px-4 pb-3 grid gap-2 ${s.media.length===1?"grid-cols-1":"grid-cols-2"}`,children:s.media.map(n=>e.jsx("div",{className:"relative rounded-lg overflow-hidden bg-slate-900/50",children:n.media_type==="video"?e.jsx("video",{src:n.media_url,poster:n.thumbnail_url,controls:!0,className:"w-full"}):e.jsx("img",{src:n.media_url,alt:"",className:"w-full object-cover"})},n.id))}),e.jsxs("div",{className:"px-4 py-3 border-t border-slate-700/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("button",{onClick:()=>Q(s.id,s.user_has_liked||!1),className:"flex items-center gap-2 text-slate-500 hover:text-rose-400 transition-colors group",children:[e.jsx(he,{className:`w-5 h-5 ${s.user_has_liked?"fill-rose-500 text-rose-500":""}`}),e.jsx("span",{className:"text-sm group-hover:text-rose-400",children:s.like_count})]}),e.jsxs("button",{onClick:()=>Y(s.id),className:"flex items-center gap-2 text-slate-500 hover:text-cyan-400 transition-colors group",children:[e.jsx(be,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm group-hover:text-cyan-400",children:s.comment_count})]}),e.jsxs("button",{onClick:()=>Z(s.id),className:"flex items-center gap-2 text-slate-500 hover:text-green-400 transition-colors group",children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm group-hover:text-green-400",children:s.share_count})]}),e.jsxs("button",{onClick:()=>se(s.id),className:"flex items-center gap-2 text-slate-500 hover:text-purple-400 transition-colors group",children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm group-hover:text-purple-400",children:"Invite"})]})]}),e.jsx("button",{onClick:()=>ee(s.id,s.user_has_bookmarked||!1),className:"text-slate-500 hover:text-amber-400 transition-colors",children:e.jsx(je,{className:`w-5 h-5 ${s.user_has_bookmarked?"fill-amber-500 text-amber-500":""}`})})]}),F===s.id&&e.jsx("div",{className:"border-t border-slate-700/50 bg-slate-900/30 p-4",children:e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:(y=$[s.id])==null?void 0:y.map(n=>{var T,H,O;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:((T=n.author)==null?void 0:T.avatar_url)||`https://api.dicebear.com/7.x/avataaars/svg?seed=${n.author_id}`,alt:(H=n.author)==null?void 0:H.display_name,className:"w-8 h-8 rounded-full flex-shrink-0 border border-slate-600/50"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-3",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-100 mb-1",children:(O=n.author)==null?void 0:O.display_name}),e.jsx("p",{className:"text-sm text-slate-300",children:n.content})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-slate-500",children:[e.jsx("span",{children:D(n.created_at)}),e.jsxs("button",{className:"hover:text-rose-400",children:["Like Â· ",n.like_count]}),e.jsx("button",{className:"hover:text-cyan-400",children:"Reply"})]})]})]},n.id)})})})]},s.id)}),C&&!N&&e.jsx("div",{className:"text-center py-4",children:e.jsx(j,{variant:"outline",onClick:()=>A(!0),className:"border-slate-700/50 hover:border-slate-600/50 text-slate-300 hover:bg-slate-800/50",children:"Load More"})})]})]})]})}export{ze as EnhancedCommunityFeed,ze as default};

var N=(a,o,t)=>new Promise((h,l)=>{var u=r=>{try{d(t.next(r))}catch(m){l(m)}},p=r=>{try{d(t.throw(r))}catch(m){l(m)}},d=r=>r.done?h(r.value):Promise.resolve(r.value).then(u,p);d((t=t.apply(a,o)).next())});import{r as n,j as e}from"./ui-vendor-nuurtrVt.js";import{c as $}from"./supabase-vendor-FQ_Qbeq7.js";import{I as J,n as U,B as b,X as O,m as w,H as D,h as S}from"./index-DvbzyI8D.js";import{B as W}from"./badge-CSla_laA.js";import{p as E}from"./photosService-GinFDzdw.js";import{A as B}from"./arrow-left-BvVPu0ip.js";import{S as V}from"./search-CTrDNXWd.js";import{U as _}from"./upload-Bt0GVixH.js";import{M as L}from"./message-circle-CDQitmPf.js";import{P as z}from"./plus-BsGHaHIV.js";import{E as F}from"./eye-DqoG2dIS.js";import{S as T}from"./share-2-De9cE97H.js";import{A as X}from"./index-B8gLKG9C.js";import"./react-vendor-DwRCIQB9.js";import"./animation-vendor-BS_UIQcx.js";const Y="https://kouywbotopkrgxyjqylb.supabase.co",M="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtvdXl3Ym90b3Brcmd4eWpxeWxiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxNDQ4NDEsImV4cCI6MjA3ODcyMDg0MX0.TTdjDQIj8mLiXm5Y_edtqkm4L17Z4jh6Aa9w92vAYoI",v=!!M;v||console.warn("VITE_SUPABASE_URL or VITE_SUPABASE_ANON_KEY is not set. Supabase client disabled; upload functions will run in demo/fallback mode.");const f=v?$(Y,M):null;function q(a,o){return N(this,null,function*(){const t=(o==null?void 0:o.bucket)||"images",h=(o==null?void 0:o.folder)||"uploads",l=`${Date.now()}_${a.name.replaceAll(" ","_")}`,u=`${h}/${l}`;if(!v||!f)return URL.createObjectURL(a);const{data:p,error:d}=yield f.storage.from(t).upload(u,a,{cacheControl:"3600",upsert:!1});if(d)throw d;const{data:r}=f.storage.from(t).getPublicUrl(u);return r.publicUrl})}function Q({bucket:a="images",folder:o="posts",onUploaded:t}){const h=n.useRef(null),[l,u]=n.useState(null),[p,d]=n.useState(!1),[r,m]=n.useState(null),x=n.useCallback(c=>N(null,null,function*(){if(!c||c.length===0)return;const k=c[0];m(null),u(URL.createObjectURL(k));try{d(!0);const g=yield q(k,{bucket:a,folder:o});t==null||t(g)}catch(g){console.error("Upload error",g),m(g.message||"Upload failed")}finally{d(!1)}}),[a,o,t]),y=n.useCallback(c=>{c.preventDefault(),x(c.dataTransfer.files)},[x]),P=n.useCallback(c=>{x(c.target.files)},[x]);return e.jsx("div",{children:e.jsxs("label",{onDrop:y,onDragOver:c=>c.preventDefault(),className:"w-full border-2 border-dashed border-white/20 rounded-2xl p-6 flex flex-col items-center justify-center cursor-pointer bg-black/40 hover:bg-black/30 transition",onClick:()=>{var c;return(c=h.current)==null?void 0:c.click()},children:[e.jsx("input",{ref:h,type:"file",accept:"image/*",className:"hidden",onChange:P}),!l&&e.jsxs("div",{className:"text-center text-slate-300",children:[e.jsx("div",{className:"mb-2",children:"Drag and drop photos here"}),e.jsx("div",{className:"text-sm",children:"or click to browse"})]}),l&&e.jsxs("div",{className:"w-full max-w-xl",children:[e.jsx("div",{className:"mb-3 text-slate-300 text-sm",children:"Preview"}),e.jsx("div",{className:"rounded-xl overflow-hidden border border-white/10",children:e.jsx(J,{src:l,alt:"Preview",className:"w-full h-64 object-cover"})})]}),e.jsx("div",{className:"mt-4 text-sm text-slate-400",children:p?"Uploadingâ€¦":r?`Error: ${r}`:"Supported: JPG, PNG, WEBP"})]})})}function G(a){return N(this,null,function*(){if(!v||!f)return console.warn("supabase disabled â€” createAlbumRecord will return a fake id for demo"),{id:`album_demo_${Date.now()}`};const{data:o,error:t}=yield f.from("albums").insert([{owner_id:null,title:a.title,description:a.description||null,cover_photo:a.cover_photo||null,total_photos:a.total_photos||0}]).select("*").single();if(t)throw t;return o})}function Z(a){return N(this,null,function*(){if(!v||!f)return console.warn("supabase disabled â€” createPhotoRecord will return a fake id for demo"),{id:`photo_demo_${Date.now()}`,public_url:a.public_url};const{data:o,error:t}=yield f.from("photos").insert([{album_id:a.album_id||null,owner_id:null,storage_path:a.storage_path||null,public_url:a.public_url||null,caption:null}]).select("*").single();if(t)throw t;return o})}function pe({category:a,onNavigate:o}){const[t,h]=n.useState(null),[l,u]=n.useState(null),[p,d]=n.useState(""),[r,m]=n.useState(!1),[x,y]=n.useState([]),c=E.getAlbumsByMatch("").filter(s=>s.title.toLowerCase().includes(p.toLowerCase())||s.description.toLowerCase().includes(p.toLowerCase())),k=()=>{switch(a){case"sports":return"âš½";case"events":return"ðŸŽµ";case"parties":return"ðŸŽ‰";case"gaming":return"ðŸŽ®"}},g=()=>{switch(a){case"sports":return"from-emerald-500 to-cyan-500";case"events":return"from-purple-500 to-pink-500";case"parties":return"from-pink-500 to-red-500";case"gaming":return"from-indigo-500 to-purple-500"}},R=()=>a.charAt(0).toUpperCase()+a.slice(1);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[e.jsx("div",{className:"sticky top-0 z-20 bg-white/95 backdrop-blur-sm border-b border-slate-200",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>{o({sports:"dashboard",events:"events-dashboard",parties:"party-dashboard",gaming:"gaming-hub"}[a])},className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(B,{className:"w-6 h-6 text-slate-700"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-3xl",children:k()}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Photo Albums"})]}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Organize and share your ",R()," memories"]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx(U,{placeholder:"Search albums...",value:p,onChange:s=>d(s.target.value),className:"pl-10"})]}),e.jsxs(b,{onClick:()=>m(!r),className:`gap-2 ${r?"bg-red-500 hover:bg-red-600":"bg-slate-800 hover:bg-slate-700"} text-white`,children:[r?e.jsx(O,{className:"w-4 h-4"}):e.jsx(_,{className:"w-4 h-4"}),r?"Cancel":"New Album"]})]})]})}),e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:t?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>h(null),className:"mb-6 flex items-center gap-2 text-slate-600 hover:text-slate-900 transition-colors",children:[e.jsx(B,{className:"w-5 h-5"}),"Back to Albums"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden mb-6",children:[e.jsx("div",{className:`h-40 bg-gradient-to-r ${g()} flex items-center justify-center`,children:e.jsx("span",{className:"text-8xl",children:t.coverPhoto})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:t.title}),e.jsx("p",{className:"text-slate-600 mb-4",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:t.totalPhotos}),e.jsx("p",{className:"text-sm text-slate-600",children:"Photos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:t.views}),e.jsx("p",{className:"text-sm text-slate-600",children:"Views"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:"â†‘"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Upload More"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:"âš™ï¸"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Settings"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-4",children:"Photos in Album"}),t.photos.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl border-2 border-dashed border-slate-300",children:[e.jsx(_,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600",children:"No photos yet"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upload your first photo to this album"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t.photos.map((s,i)=>{const C=typeof s.url=="string"&&(s.url.startsWith("http")||s.url.startsWith("data:")||s.url.startsWith("blob:"));return e.jsxs(w.div,{whileHover:{scale:1.05},onClick:()=>u(s),className:"aspect-square rounded-xl overflow-hidden cursor-pointer relative group bg-slate-100",children:[C?e.jsx("div",{className:"w-full h-full bg-slate-800 flex items-center justify-center",children:e.jsx("img",{src:s.url,alt:s.caption||`photo-${i}`,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-5xl bg-gradient-to-br from-slate-200 to-slate-300",children:s.url}),e.jsxs("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100",children:[e.jsx("button",{className:"p-2 bg-white rounded-lg hover:bg-slate-100",children:e.jsx(D,{className:"w-5 h-5 text-red-500"})}),e.jsx("button",{className:"p-2 bg-white rounded-lg hover:bg-slate-100",children:e.jsx(L,{className:"w-5 h-5 text-blue-500"})})]}),e.jsxs("div",{className:"absolute top-2 right-2 bg-white/90 backdrop-blur px-2 py-1 rounded text-xs font-semibold text-slate-900",children:[s.likes," likes"]})]},i)})})]})]}):r?e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-lg p-8 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-6",children:"Create New Album"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Album Title"}),e.jsx(U,{placeholder:"e.g., Championship Victory Photos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Description"}),e.jsx("textarea",{placeholder:"Describe the event or memory...",className:"w-full px-4 py-3 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-400 min-h-[100px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Upload Photos"}),e.jsx(Q,{onUploaded:s=>y(i=>[...i,s])}),x.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2",children:x.map((s,i)=>e.jsx("div",{className:"rounded-lg overflow-hidden border bg-slate-800",children:e.jsx("img",{src:s,alt:`uploaded-${i}`,className:"w-full h-24 object-cover"})},i))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Match/Event"}),e.jsxs("select",{className:"w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-400",children:[e.jsx("option",{children:"Select a match or event..."}),e.jsx("option",{children:"Football Championship - Jan 10"}),e.jsx("option",{children:"Gaming Tournament - Jan 12"}),e.jsx("option",{children:"Badminton Match - Jan 15"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{onClick:()=>N(null,null,function*(){var C,I;const s=((C=document.querySelector("input[placeholder]"))==null?void 0:C.value)||"New Album",i=((I=document.querySelector("textarea"))==null?void 0:I.value)||"";if(v)try{const j=yield G({owner_id:null,title:s,description:i,cover_photo:x[0]||null,total_photos:x.length});for(const A of x)yield Z({album_id:j.id,owner_id:null,public_url:A,caption:""});S.success("Album created and persisted to Supabase! ðŸŽ‰")}catch(j){console.error("DB persist error",j),S.error("Album created locally, but failed to persist to DB.")}else{const j=x.map((A,H)=>({matchId:"",userId:"user_demo",url:A,caption:"",uploadedAt:new Date().toISOString(),likes:0,comments:[],tags:[]}));E.createAlbum({matchId:"",title:s,description:i,photos:j,createdAt:new Date().toISOString(),coverPhoto:j.length>0?"ðŸ“¸":"ðŸ–¼ï¸",totalPhotos:j.length,views:0}),S.success("Album created locally (demo mode) ðŸŽ‰")}m(!1),y([])}),className:"flex-1 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white",children:"Create Album"}),e.jsx(b,{onClick:()=>m(!1),className:"flex-1 bg-slate-100 hover:bg-slate-200 text-slate-900",children:"Cancel"})]})]}):e.jsx("div",{children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 text-lg",children:"No albums yet"}),e.jsx("p",{className:"text-slate-500 text-sm mb-6",children:"Create your first album to organize photos from your events"}),e.jsxs(b,{onClick:()=>m(!0),className:"bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Create First Album"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map((s,i)=>e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.1},onClick:()=>h(s),className:"bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-all cursor-pointer group",children:[e.jsxs("div",{className:`h-40 bg-gradient-to-r ${g()} flex items-center justify-center relative overflow-hidden`,children:[e.jsx("span",{className:"text-6xl group-hover:scale-110 transition-transform",children:s.coverPhoto}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center",children:e.jsx(F,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-all"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-slate-900 line-clamp-2 mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-slate-600 line-clamp-2 mb-4",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4 text-xs",children:[e.jsxs("div",{className:"bg-slate-50 rounded p-2 text-center",children:[e.jsx("p",{className:"font-bold text-slate-900",children:s.totalPhotos}),e.jsx("p",{className:"text-slate-600",children:"Photos"})]}),e.jsxs("div",{className:"bg-slate-50 rounded p-2 text-center",children:[e.jsx("p",{className:"font-bold text-slate-900",children:s.views}),e.jsx("p",{className:"text-slate-600",children:"Views"})]})]}),e.jsx(b,{className:"w-full bg-slate-100 hover:bg-slate-200 text-slate-900 group-hover:bg-slate-800 group-hover:text-white transition-colors",children:"View Album"})]})]},s.id))})})}),e.jsx(X,{children:l&&e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>u(null),className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",children:e.jsxs(w.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},onClick:s=>s.stopPropagation(),className:"bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"w-full h-80 flex items-center justify-center bg-slate-100",children:typeof l.url=="string"&&(l.url.startsWith("http")||l.url.startsWith("data:")||l.url.startsWith("blob:"))?e.jsx("img",{src:l.url,alt:l.caption||"photo",className:"w-full h-full object-contain"}):e.jsx("div",{className:"text-9xl",children:l.url})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:l.caption}),e.jsx("p",{className:"text-sm text-slate-600",children:l.uploadedAt})]}),l.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:l.tags.map((s,i)=>e.jsxs(W,{className:"bg-slate-100 text-slate-700",children:["#",s]},i))}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-4 border-t border-slate-200",children:[e.jsxs(b,{className:"flex items-center justify-center gap-2 bg-red-50 hover:bg-red-100 text-red-600",children:[e.jsx(D,{className:"w-4 h-4"}),l.likes]}),e.jsxs(b,{className:"flex items-center justify-center gap-2 bg-blue-50 hover:bg-blue-100 text-blue-600",children:[e.jsx(L,{className:"w-4 h-4"}),l.comments.length]}),e.jsxs(b,{className:"flex items-center justify-center gap-2 bg-green-50 hover:bg-green-100 text-green-600",children:[e.jsx(T,{className:"w-4 h-4"}),"Share"]})]}),l.comments.length>0&&e.jsxs("div",{className:"pt-4 border-t border-slate-200",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-3",children:"Comments"}),e.jsx("div",{className:"space-y-3",children:l.comments.map((s,i)=>e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-slate-900 text-sm",children:s.userName}),e.jsx("p",{className:"text-slate-700 text-sm",children:s.text}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:s.timestamp})]},i))})]})]})]})})})]})}export{pe as PhotoAlbum};
